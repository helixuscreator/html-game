<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Match-3 Swap Sound Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; display:flex; flex-direction:column; align-items:center; font-family:Arial,sans-serif; background:#eee; }
  canvas { border:1px solid #333; margin-top:20px; touch-action: none; }
  #score { font-size:20px; margin-top:10px; }
</style>
</head>
<body>
<h1>Match-3 Swap Sound Test</h1>
<canvas id="gameCanvas" width="360" height="360"></canvas>
<div id="score">Punkte: 0</div>

<audio id="swapSound" src="swap.mp3"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const swapSound = document.getElementById('swapSound');

const rows = 6;
const cols = 6;
const cellSize = canvas.width / cols;
const colors = ['red','green','blue','yellow','orange','purple'];

let grid = [];
let score = 0;
let animating = false;
const scoreEl = document.getElementById('score');
let first = null;

function drawGrid(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      let item = grid[r][c];
      ctx.fillStyle = item.color;
      ctx.fillRect(item.x*cellSize, item.y*cellSize, cellSize-2, cellSize-2);
      if(first && first[0]===r && first[1]===c){
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 3;
        ctx.strokeRect(item.x*cellSize+1, item.y*cellSize+1, cellSize-4, cellSize-4);
      }
    }
  }
}

function initGrid(){
  grid=[];
  for(let r=0;r<rows;r++){
    let row=[];
    for(let c=0;c<cols;c++){
      row.push({color: colors[Math.floor(Math.random()*colors.length)], x:c, y:r});
    }
    grid.push(row);
  }
  drawGrid();
}

function animateSwap(r1,c1,r2,c2){
  if(!animating) swapSound.play(); // Sound beim Swap
  animating=true;
  const item1 = grid[r1][c1];
  const item2 = grid[r2][c2];
  const frames=10; let step=0;
  function stepSwap(){
    step++;
    let dx=(c2-c1)/frames; let dy=(r2-r1)/frames;
    item1.x=c1+dx*step; item1.y=r1+dy*step;
    item2.x=c2-dx*step; item2.y=r2-dy*step;
    drawGrid();
    if(step<frames) requestAnimationFrame(stepSwap);
    else{
      [item1.color,item2.color]=[item2.color,item1.color];
      item1.x=c1; item1.y=r1; item2.x=c2; item2.y=r2;
      drawGrid();
      animating=false;
    }
  }
  requestAnimationFrame(stepSwap);
}

// Auswahl
canvas.addEventListener('mousedown', startSelect);
canvas.addEventListener('touchstart', e=>{e.preventDefault(); startSelect(e.touches[0]);});

function startSelect(e){
  if(animating) return;
  const rect = canvas.getBoundingClientRect();
  const c = Math.floor((e.clientX - rect.left)/cellSize);
  const r = Math.floor((e.clientY - rect.top)/cellSize);
  if(!first) first=[r,c];
  else {
    const [r0,c0]=first;
    if(Math.abs(r-r0)+Math.abs(c-c0)===1) animateSwap(r0,c0,r,c);
    first=null;
  }
  drawGrid();
}

initGrid();
drawGrid();
</script>
</body>
</html>
